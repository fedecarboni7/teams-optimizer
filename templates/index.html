{% extends "base.html" %}

{% block title %}Armar Equipos | Home{% endblock %}

{% block head %}
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Page-specific CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/formations.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/clubs.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/scale-toggle.css') }}">
    
    <link rel="canonical" href="https://armarequipos.lat/home" />
{% endblock %}

{% block content %}
    <div class="content">
        <h1>Armar Equipos</h1>

        <div class="club-section">
            <div class="club-container">
                <!-- Header Controls -->
                <div class="header-controls">
                    <div class="sort-container" style="display: flex; justify-content: flex-end;">
                        <button id="sortButton" class="sort-button" data-action="toggle-sort">
                            <i class="fas fa-sort-alpha-down"></i>
                        </button>
                    </div>
                    
                    <!-- Club selector -->
                    <div class="club-selector">
                        <i class="fa-solid fa-users icon"></i>
                        <select id="club-select" name="clubId" data-action="switch-context">
                            <option value="">Mis Jugadores</option>
                            {% for club in user_clubs %}
                            <option value="{{ club.id }}" {% if club.id == clubId %}selected{% endif %}>{{ club.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Invitations notification -->
                    {% if pending_invitations > 0 %}
                    <div class="invitations-notification" data-action="open-modal" data-modal="invitationsModal">
                        <i class="fa-solid fa-bell"></i>
                        <span>{{ pending_invitations }} invitación{% if pending_invitations > 1 %}es{% endif %} pendiente{% if pending_invitations > 1 %}s{% endif %}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Player Form -->
        <form id="player-form" data-action="submit-form">
            {% if clubId %}
            <input type="hidden" name="clubId" value="{{ clubId }}">
            {% endif %}
            <input type="hidden" name="scale" value="{{ scale }}">
            
            <div id="players-container" class="player-container">
                {% for player in players %}
                <div class="player-entry">
                    <div class="player-header">
                        <input type="checkbox" name="selectedPlayers" value="{{ player.id }}">
                        <input type="text" name="names" value="{{ player.name }}" placeholder="Jugador {{ loop.index }}" data-action="toggle-details" required readonly>
                        <button class="toggle-details" type="button" data-action="toggle-details">
                            <i class="fa-solid fa-angle-down toggle-icon"></i>
                        </button>
                        <button class="delete-button" id="{{ player.id }}" type="button" data-action="delete-player" club-id="{{ clubId }}">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                    
                    <div class="details-container" style="max-height: 0px;">
                        <div class="skills-container">
                            <!-- Player skills rendered here -->
                            <div class="skill-entry">
                                <label>Velocidad:</label>
                                <input type="range" name="velocidad" min="1" max="{{ scale }}" value="{{ player.velocidad }}" class="slider-rating">
                                <span class="value-display">{{ player.velocidad }}</span>
                            </div>
                            <!-- Additional skills would follow the same pattern -->
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Form Controls -->
            <div class="form-controls">
                <button type="button" class="add-button" data-action="add-player">Agregar Jugador</button>
                <button type="button" id="toggle-select-button" data-action="toggle-select-all">Seleccionar a todos</button>
                <button type="button" class="reset-button" id="resetBtn" data-action="delete-selected">Borrar seleccionados</button>
            </div>

            <!-- Scale Toggle -->
            <div class="scale-section">
                <label>Escala de puntuación:</label>
                <div class="scale-toggle">
                    <button type="button" class="scale-option {% if scale == 5 %}active{% endif %}" data-action="set-scale" data-scale="5">1-5</button>
                    <button type="button" class="scale-option {% if scale == 10 %}active{% endif %}" data-action="set-scale" data-scale="10">1-10</button>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" id="submitBtn" class="submitBtn">Armar Equipos</button>
        </form>

        <!-- Profile and Logout Links -->
        <br>
        <a href="/profile" class="profile-link">
            <i class="fa-solid fa-user"></i> Mi Perfil
        </a>
        <br>
        <a href="/logout" class="logout-link">
            <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesión ({{ currentUser.userName }})
        </a>

        <!-- Teams Results Container -->
        <div id="teams-container">
            <!-- Teams will be loaded here dynamically -->
        </div>

        <!-- Floating Button for Selected Players -->
        <div id="floating-button">
            <i class="fa-solid fa-list-check" style="font-size: 20px;"></i>
            <span id="selected-count" class="badge">0</span>
            <div id="selected-players-list" class="hidden">
                <ul id="selected-players-ul"></ul>
            </div>
        </div>

        <!-- Scroll Button -->
        <button type="button" id="scroll-button" data-action="scroll-to-submit">
            <i class="fa-solid fa-circle-down"></i>
        </button>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-links">
            <a class="feedback-button" href="https://form.typeform.com/to/FJzZpDL4" target="_blank" rel="noopener noreferrer">
                <i class="fa-regular fa-comment"></i>
                <span>Dejame tu opinión</span>
            </a>
        </div>
        <div class="copyright">
            <i class="fas fa-code"></i> with ❤️ by <a href="https://github.com/fedecarboni7" target="_blank">fedecarboni7</a>
        </div>
    </footer>
{% endblock %}

{% block scripts %}
    <!-- Page-specific JavaScript -->
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/teamLogic.js') }}"></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
    <script src="{{ url_for('static', filename='js/changeTracker.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/formations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/clubs.js') }}"></script>
    <script src="{{ url_for('static', filename='js/scaleManager.js') }}"></script>
{% endblock %}